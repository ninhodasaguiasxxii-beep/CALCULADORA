<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4º GUERRA CALCULATOR - Pro Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(240 3.7% 15.9%)",
                        background: "hsl(240 10% 3.9%)",
                        foreground: "hsl(0 0% 98%)",
                        primary: {
                            DEFAULT: "hsl(142.1 70.6% 45.3%)",
                            foreground: "hsl(144.9 58.7% 10.8%)",
                        },
                        muted: {
                            DEFAULT: "hsl(240 3.7% 15.9%)",
                            foreground: "hsl(240 5% 64.9%)",
                        },
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { background-color: hsl(240 10% 3.9%); color: hsl(0 0% 98%); font-family: 'Inter', sans-serif; }
        .hover-elevate { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-elevate:hover { transform: translateY(-4px); box-shadow: 0 20px 40px -20px rgba(34, 197, 94, 0.4); border-color: rgba(34, 197, 94, 0.5); }
        input[type="number"], input[type="text"], select { background: hsl(240 3.7% 10%); border: 1px solid hsl(240 3.7% 15.9%); color: white; padding: 0.6rem; border-radius: 8px; width: 100%; transition: all 0.2s; }
        input:focus { outline: none; border-color: hsl(142.1 70.6% 45.3%); box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2); }
        input[type="checkbox"] { accent-color: hsl(142.1 70.6% 45.3%); width: 1.2rem; height: 1.2rem; cursor: pointer; }
        input[type="range"] { accent-color: hsl(142.1 70.6% 45.3%); height: 6px; background: hsl(240 3.7% 15.9%); border-radius: 99px; cursor: pointer; }
        .point-animation { pointer-events: none; position: fixed; font-weight: 900; z-index: 100; animation: floatUp 1s ease-out forwards; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; scale: 1; } 100% { transform: translateY(-60px); opacity: 0; scale: 1.2; } }
        .glow-text { text-shadow: 0 0 15px rgba(34, 197, 94, 0.5); }
        .floating-intel { position: absolute; bottom: 110%; left: 0; width: 280px; background: hsl(240 10% 12%); border: 1px solid hsl(142.1 70.6% 45.3%); padding: 12px; border-radius: 12px; z-index: 60; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; pointer-events: none; }
        .group:hover .floating-intel { display: block; }
        
        /* Progress Bar Styles */
        .war-progress-container { width: 100%; background: hsl(240 3.7% 15.9%); height: 8px; border-radius: 4px; overflow: hidden; margin-top: 1rem; position: relative; }
        .war-progress-bar { height: 100%; background: linear-gradient(90deg, hsl(142.1 70.6% 45.3%), #22c55e); transition: width 0.5s ease-out; }
        .war-progress-info { display: flex; justify-content: space-between; font-size: 10px; font-weight: 900; text-transform: uppercase; color: hsl(240 5% 64.9%); margin-top: 0.5rem; letter-spacing: 0.05em; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-4xl mx-auto space-y-8">
        <header class="flex flex-col md:flex-row justify-between items-center border-b border-zinc-800 pb-8 sticky top-0 bg-background/90 backdrop-blur-xl z-50">
            <div class="text-center md:text-left mb-4 md:mb-0 w-full md:w-auto">
                <h1 class="text-3xl font-black tracking-tighter">CALCULADORA <span class="text-primary glow-text">GUERRA</span></h1>
                <div class="flex items-center gap-3 mt-1 justify-center md:justify-start">
                    <p class="text-[10px] text-muted-foreground uppercase font-mono tracking-widest">System Status: Active</p>
                    <input type="date" id="reportDate" onmouseover="this.showPicker()" onchange="updateWarProgress()" class="!w-auto bg-transparent border-none text-[10px] p-0 font-mono text-primary cursor-pointer">
                </div>
                
                <!-- War Progress Bar -->
                <div class="war-progress-container">
                    <div id="warProgressBar" class="war-progress-bar" style="width: 0%"></div>
                </div>
                <div class="war-progress-info">
                    <span>Início: 02 Fev</span>
                    <span id="warProgressText">Dia 0</span>
                    <span>Fim: 15 Fev</span>
                </div>
            </div>
            <div class="text-right">
                <div id="total-points" class="text-5xl font-black text-primary glow-text">0 PTS</div>
                <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest mt-1 text-center md:text-right">Accumulated Score</p>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <section class="bg-zinc-900/40 border border-zinc-800/50 rounded-2xl p-6 space-y-6 hover-elevate">
                <h2 class="text-xs font-black text-primary uppercase tracking-[0.2em] flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-primary animate-pulse"></span> Tempo e Geral
                </h2>
                
                <div class="space-y-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div class="flex items-center gap-2">
                            <div class="flex-1">
                                <div class="flex justify-between mb-2">
                                    <label class="text-[10px] font-bold text-zinc-400 uppercase">Horas Estudadas (Normais)</label>
                                    <span class="text-primary font-black" id="hours-val">0.0h</span>
                                </div>
                                <input type="range" id="hours" min="0" max="24" step="0.5" value="0" oninput="updateRange('hours')" class="w-full">
                            </div>
                            <input type="text" id="hours-exact" placeholder="ex: 1h30m" oninput="updateExact('hours')" class="!w-24 text-xs">
                        </div>

                        <div class="flex items-center gap-2">
                            <div class="flex-1">
                                <div class="flex justify-between mb-2">
                                    <label class="text-[10px] font-bold text-zinc-400 uppercase">Call STREAM (YPT/Disc)</label>
                                    <span class="text-primary font-black" id="streamHours-val">0.0h</span>
                                </div>
                                <input type="range" id="streamHours" min="0" max="24" step="0.5" value="0" oninput="updateRange('streamHours')" class="w-full">
                            </div>
                            <input type="text" id="streamHours-exact" placeholder="ex: 1h" oninput="updateExact('streamHours')" class="!w-24 text-xs">
                        </div>

                        <div class="flex items-center gap-2">
                            <div class="flex-1">
                                <div class="flex justify-between mb-2">
                                    <label class="text-[10px] font-bold text-zinc-400 uppercase">Call CAM (YPT/Disc)</label>
                                    <span class="text-primary font-black" id="camHours-val">0.0h</span>
                                </div>
                                <input type="range" id="camHours" min="0" max="24" step="0.5" value="0" oninput="updateRange('camHours')" class="w-full">
                            </div>
                            <input type="text" id="camHours-exact" placeholder="ex: 1h" oninput="updateExact('camHours')" class="!w-24 text-xs">
                        </div>
                    </div>

                    <div class="bg-primary/5 p-4 rounded-xl border border-primary/20 text-center">
                        <span class="text-[10px] font-bold text-zinc-500 uppercase block mb-1">Somatório Total de Tempo</span>
                        <div class="text-2xl font-black text-primary" id="total-hours-sum">0h 0m 0s</div>
                    </div>

                    <div class="flex items-center gap-2">
                        <div class="flex-1">
                            <div class="flex justify-between mb-2">
                                <label class="text-[10px] font-bold text-zinc-400 uppercase">Horas de Ouro (+50/h)</label>
                                <span class="text-primary font-black" id="madrugada-val">0.0h</span>
                            </div>
                            <input type="range" id="madrugada" min="0" max="6" step="0.5" value="0" oninput="updateRange('madrugada')" class="w-full">
                        </div>
                        <input type="text" id="madrugada-exact" placeholder="ex: 1h" oninput="updateExact('madrugada')" class="!w-24 text-xs">
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold mb-1.5 text-zinc-400 uppercase">Páginas Lidas</label>
                        <input type="number" id="pages" value="0" min="0" oninput="calcWithAnim('pages')">
                    </div>

                    <div class="bg-zinc-800/30 p-4 rounded-xl border border-zinc-700/50">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="workSchool" onchange="calcWithAnim('workSchool')">
                            <label class="text-sm font-bold uppercase cursor-pointer" for="workSchool">TEVE AULA/TRABALHO/FACULDADE (+300)</label>
                        </div>
                        <input type="text" id="workSchoolName" placeholder="NOME DO LOCAL" class="mt-3 text-[11px] h-9">
                    </div>
                </div>
            </section>

            <div class="space-y-8">
                <!-- REDAÇÕES & QUESTÕES -->
                <section class="bg-zinc-900/40 border border-zinc-800/50 rounded-2xl p-6 space-y-6 hover-elevate">
                    <h2 class="text-xs font-black text-primary uppercase tracking-[0.2em] flex items-center justify-between">
                        <span><span class="w-2 h-2 rounded-full bg-primary inline-block mr-2"></span> Níveis e Questões</span>
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- REDAÇÃO -->
                        <div class="space-y-3">
                            <h3 class="text-[10px] font-black text-zinc-500 uppercase">REDAÇÃO</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="relative group">
                                    <div class="bg-black/20 p-2 rounded-lg border border-zinc-800">
                                        <label class="block text-[8px] font-bold text-zinc-600 mb-1">N1 (30)</label>
                                        <input type="number" id="essay1" value="0" min="0" oninput="calcWithAnim('essay1')" class="!bg-transparent !border-none !p-0 font-bold text-lg">
                                    </div>
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 1:</div><div class="text-zinc-400 text-[9px]">ESA, UEMA, UEA, VESTIBULARES REGIONAIS, FACULDADES PRIVADAS</div></div>
                                </div>
                                <div class="relative group">
                                    <div class="bg-black/20 p-2 rounded-lg border border-zinc-800">
                                        <label class="block text-[8px] font-bold text-zinc-600 mb-1">N2 (40)</label>
                                        <input type="number" id="essay2" value="0" min="0" oninput="calcWithAnim('essay2')" class="!bg-transparent !border-none !p-0 font-bold text-lg">
                                    </div>
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 2:</div><div class="text-zinc-400 text-[9px]">CN; EPCAr; UERJ / UnB / UFPR, EsFCEx, ESPCEX</div></div>
                                </div>
                                <div class="relative group">
                                    <div class="bg-black/20 p-2 rounded-lg border border-zinc-800">
                                        <label class="block text-[8px] font-bold text-zinc-600 mb-1">N3 (50)</label>
                                        <input type="number" id="essay3" value="0" min="0" oninput="calcWithAnim('essay3')" class="!bg-transparent !border-none !p-0 font-bold text-lg">
                                    </div>
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 3:</div><div class="text-zinc-400 text-[9px]">AFA, EFOMM, UNESP, ENEM</div></div>
                                </div>
                                <div class="relative group">
                                    <div class="bg-black/20 p-2 rounded-lg border border-zinc-800">
                                        <label class="block text-[8px] font-bold text-zinc-600 mb-1">N4 (60)</label>
                                        <input type="number" id="essay4" value="0" min="0" oninput="calcWithAnim('essay4')" class="!bg-transparent !border-none !p-0 font-bold text-lg">
                                    </div>
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 4:</div><div class="text-zinc-400 text-[9px]">ITA, IME, FUVEST, UNICAMP, EN</div></div>
                                </div>
                            </div>
                        </div>

                        <!-- MAT/FIS/QUI -->
                        <div class="space-y-3 pt-3 border-t border-zinc-800/50">
                            <h3 class="text-[10px] font-black text-zinc-500 uppercase">MAT. & FIS. & QUIM.</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="relative group">
                                    <input type="number" id="q_mfq1" value="0" min="0" oninput="calcWithAnim('q_mfq1')" placeholder="N1" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 1 (+1):</div><div class="text-zinc-400 text-[9px]">ENEM, Vest. Civil; CFN; ESA; EEAr; e, EAM</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_mfq2" value="0" min="0" oninput="calcWithAnim('q_mfq2')" placeholder="N2" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 2 (+3):</div><div class="text-zinc-400 text-[9px]">EsPCEx, FUVEST 1 fase, EPCAr</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_mfq3" value="0" min="0" oninput="calcWithAnim('q_mfq3')" placeholder="N3" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 3 (+6):</div><div class="text-zinc-400 text-[9px]">EFOMM; AFA; CN, EN, FUVEST 2 fase</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_mfq4" value="0" min="0" oninput="calcWithAnim('q_mfq4')" placeholder="N4" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 4 (+10):</div><div class="text-zinc-400 text-[9px]">ITA; IME; e, olimpíadas</div></div>
                                </div>
                            </div>
                        </div>

                        <!-- HUMANAS -->
                        <div class="space-y-3 pt-3 border-t border-zinc-800/50">
                            <h3 class="text-[10px] font-black text-zinc-500 uppercase">HIS, GEO, BIO & HUMANAS</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="relative group">
                                    <input type="number" id="q_hum1" value="0" min="0" oninput="calcWithAnim('q_hum1')" placeholder="N1" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 1 (+1):</div><div class="text-zinc-400 text-[9px]">Questões de fixação</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_hum2" value="0" min="0" oninput="calcWithAnim('q_hum2')" placeholder="N2" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 2 (+3):</div><div class="text-zinc-400 text-[9px]">Vest. Civil; e, ESA</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_hum3" value="0" min="0" oninput="calcWithAnim('q_hum3')" placeholder="N3" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 3 (+6):</div><div class="text-zinc-400 text-[9px]">CN; Olimpíadas; Fuvest 1ª Fase; EsPCEx</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_hum4" value="0" min="0" oninput="calcWithAnim('q_hum4')" placeholder="N4" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 4 (+10):</div><div class="text-zinc-400 text-[9px]">Fuvest 2ª Fase; Unicamp 2ª Fase</div></div>
                                </div>
                            </div>
                        </div>

                        <!-- PORT/ING -->
                        <div class="space-y-3 pt-3 border-t border-zinc-800/50">
                            <h3 class="text-[10px] font-black text-zinc-500 uppercase">PORT. & INGLES.</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="relative group">
                                    <input type="number" id="q_lin1" value="0" min="0" oninput="calcWithAnim('q_lin1')" placeholder="N1" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 1 (+1):</div><div class="text-zinc-400 text-[9px]">Vest. Civil; EAM; e, CFN</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_lin2" value="0" min="0" oninput="calcWithAnim('q_lin2')" placeholder="N2" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 2 (+3):</div><div class="text-zinc-400 text-[9px]">EsPCEx; CN; EPCAr; ESA; ITA; IME</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_lin3" value="0" min="0" oninput="calcWithAnim('q_lin3')" placeholder="N3" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 3 (+6):</div><div class="text-zinc-400 text-[9px]">EEAr(BCT); AFA e Concurso Público</div></div>
                                </div>
                                <div class="relative group">
                                    <input type="number" id="q_lin4" value="0" min="0" oninput="calcWithAnim('q_lin4')" placeholder="N4" class="text-center text-xs p-1">
                                    <div class="floating-intel"><div class="text-primary text-[10px] mb-1">NÍVEL 4 (+10):</div><div class="text-zinc-400 text-[9px]">EFOMM e EN</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- EVENTOS -->
                <section class="bg-zinc-900/40 border border-zinc-800/50 rounded-2xl p-6 space-y-6 hover-elevate">
                    <h2 class="text-xs font-black text-primary uppercase tracking-[0.2em] flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-primary inline-block"></span> Eventos e Missões
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-zinc-500 uppercase mb-1.5">Kahoot (Posição)</label>
                            <select id="kahootPos" onchange="calcWithAnim('kahootPos')" class="text-xs">
                                <option value="0">Não participou</option>
                                <option value="250">Abaixo de Top 5 (250)</option>
                                <option value="500">Top 5 (500)</option>
                                <option value="1000">Top 4 (1000)</option>
                                <option value="1500">Top 3 (1500)</option>
                                <option value="2000">Top 2 (2000)</option>
                                <option value="3500">Top 1 (3500)</option>
                            </select>
                        </div>
                        <div class="bg-zinc-800/30 p-4 rounded-xl border border-zinc-700/50">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" id="coletiva" onchange="calcWithAnim('coletiva')">
                                <label class="text-sm font-bold uppercase cursor-pointer">LISTA COLETIVA (+500)</label>
                            </div>
                            <input type="text" id="coletivaWith" placeholder="FEZ COM QUEM?" class="mt-3 text-[11px] h-9">
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- SIMULADO -->
        <section class="bg-primary/5 border border-primary/20 rounded-2xl p-6 space-y-6 hover-elevate">
            <h2 class="text-xs font-black text-primary uppercase tracking-[0.2em] flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-primary inline-block"></span> Protocolo Simulado
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="flex items-center gap-4 bg-black/20 p-5 rounded-xl border border-primary/10">
                    <input type="checkbox" id="simulado" onchange="calcWithAnim('simulado')">
                    <label class="text-sm font-bold uppercase cursor-pointer">Simulado Realizado (+200)</label>
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-zinc-500 uppercase">Precisão / Desempenho</label>
                    <select id="simuladoAcc" onchange="calcWithAnim('simuladoAcc')" class="text-xs">
                        <option value="none">Precisão < 70%</option>
                        <option value="70">Precisão > 70% (+180)</option>
                        <option value="90">Precisão > 90% (+250)</option>
                    </select>
                </div>
            </div>
        </section>

        <div class="pt-4">
            <button onclick="copyReport()" class="w-full bg-primary text-primary-foreground font-black py-5 rounded-2xl hover:scale-[1.01] transition-all active:scale-[0.98] shadow-2xl shadow-primary/20 text-lg tracking-widest uppercase">
                Copiar Relatório Formatado
            </button>
        </div>
        
        <pre id="report" class="bg-black/60 p-8 rounded-2xl border border-zinc-800/50 text-[13px] font-mono whitespace-pre-wrap leading-relaxed text-zinc-300 italic shadow-inner"></pre>
    </div>

    <script>
        document.getElementById('reportDate').valueAsDate = new Date();
        let lastPoints = 0;

        function updateWarProgress() {
            const dateInput = document.getElementById('reportDate').value;
            if (!dateInput) return;
            
            const selectedDate = new Date(dateInput + 'T12:00:00');
            const startDate = new Date('2026-02-02T00:00:00');
            const endDate = new Date('2026-02-15T23:59:59');
            
            const totalDuration = endDate - startDate;
            const currentElapsed = selectedDate - startDate;
            
            let percentage = (currentElapsed / totalDuration) * 100;
            percentage = Math.max(0, Math.min(100, percentage));
            
            const dayOfWar = Math.floor(currentElapsed / (1000 * 60 * 60 * 24)) + 1;
            const totalDays = Math.ceil(totalDuration / (1000 * 60 * 60 * 24));
            
            document.getElementById('warProgressBar').style.width = percentage + '%';
            
            if (dayOfWar < 1) {
                document.getElementById('warProgressText').innerText = 'Guerra ainda não começou';
            } else if (dayOfWar > totalDays) {
                document.getElementById('warProgressText').innerText = 'Guerra encerrada';
            } else {
                document.getElementById('warProgressText').innerText = `Dia ${dayOfWar} de ${totalDays}`;
            }
        }

        // Initialize progress
        setTimeout(updateWarProgress, 100);

        function timeToHours(timeStr) {
            if (!timeStr || typeof timeStr !== 'string') return 0;
            // Handle X.5 format
            if (!isNaN(timeStr) || (timeStr.includes('.') && !timeStr.toLowerCase().includes('h'))) {
                return parseFloat(timeStr) || 0;
            }
            
            let hours = 0;
            const hMatch = timeStr.match(/(\d+(\.\d+)?)h/i);
            const mMatch = timeStr.match(/(\d+)m/i);
            const sMatch = timeStr.match(/(\d+)s/i);
            
            if (hMatch) hours += parseFloat(hMatch[1]);
            if (mMatch) hours += parseInt(mMatch[1]) / 60;
            if (sMatch) hours += parseInt(sMatch[1]) / 3600;
            
            return hours || 0;
        }

        function formatHMS(h) {
            const hrs = Math.floor(h);
            const mins = Math.floor(Math.round((h - hrs) * 60 * 100) / 100);
            const secs = Math.round(((h - hrs) * 60 - mins) * 60);
            return `${hrs}h ${mins}m ${secs}s`;
        }

        function updateRange(id) {
            const val = parseFloat(document.getElementById(id).value);
            document.getElementById(id + '-val').innerText = val.toFixed(1) + 'h';
            document.getElementById(id + '-exact').value = val.toFixed(1) + 'h';
            calcWithAnim(id);
        }

        function updateExact(id) {
            const valStr = document.getElementById(id + '-exact').value;
            const h = timeToHours(valStr);
            document.getElementById(id).value = h;
            document.getElementById(id + '-val').innerText = h.toFixed(1) + 'h';
            calcWithAnim(id);
        }

        function showPointPop(points, elementId) {
            if (points === 0) return;
            const el = document.getElementById(elementId);
            const rect = el.getBoundingClientRect();
            const pop = document.createElement('div');
            pop.innerText = points > 0 ? `+${points}` : points;
            pop.className = `point-animation ${points > 0 ? 'text-primary' : 'text-red-500'}`;
            pop.style.left = `${rect.left + rect.width / 2}px`;
            pop.style.top = `${rect.top}px`;
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 1000);
        }

        function calcWithAnim(triggerId) {
            const currentTotal = calculateTotal();
            const diff = Math.floor(currentTotal - lastPoints);
            if (diff !== 0) showPointPop(diff, triggerId);
            lastPoints = currentTotal;
            updateDisplay(currentTotal);
        }

        function calculateTotal() {
            let total = 0;
            const getV = (id) => parseFloat(document.getElementById(id).value) || 0;
            const getExactV = (id) => timeToHours(document.getElementById(id + '-exact').value) || 0;
            const isC = (id) => document.getElementById(id).checked;

            const h = getExactV('hours');
            const sh = getExactV('streamHours');
            const ch = getExactV('camHours');
            const mad = getExactV('madrugada');
            
            // Base time points
            let timePoints = (h + sh + ch) * 100;
            
            // Automatic Multipliers
            if (sh > 0 && ch > 0) {
                timePoints *= 1.6;
            } else if (sh > 0 || ch > 0) {
                timePoints *= 1.3;
            }
            
            total += timePoints;

            const totalH = h + sh + ch;
            if (totalH >= 12) total += 300;
            else if (totalH >= 8) total += 200;
            else if (totalH >= 5) total += 100;
            else if (totalH >= 3) total += 50;

            total += mad * 50;
            if (isC('workSchool')) total += 300;
            total += Math.floor(getV('pages') / 20) * 8;

            total += getV('essay1') * 30 + getV('essay2') * 40 + getV('essay3') * 50 + getV('essay4') * 60;
            
            const q_mfq = getV('q_mfq1') * 1 + getV('q_mfq2') * 3 + getV('q_mfq3') * 6 + getV('q_mfq4') * 10;
            const q_hum = getV('q_hum1') * 1 + getV('q_hum2') * 3 + getV('q_hum3') * 6 + getV('q_hum4') * 10;
            const q_lin = getV('q_lin1') * 1 + getV('q_lin2') * 3 + getV('q_lin3') * 6 + getV('q_lin4') * 10;
            total += q_mfq + q_hum + q_lin;

            total += parseInt(document.getElementById('kahootPos').value) || 0;
            if (isC('coletiva')) total += 500;

            if (isC('simulado')) {
                total += 200;
                const acc = document.getElementById('simuladoAcc').value;
                if (acc === '70') total += 180;
                if (acc === '90') total += 250;
            }
            return total;
        }

        function updateDisplay(total) {
            document.getElementById('total-points').innerText = Math.floor(total).toLocaleString() + " PTS";
            const h = timeToHours(document.getElementById('hours-exact').value) || 0;
            const sh = timeToHours(document.getElementById('streamHours-exact').value) || 0;
            const ch = timeToHours(document.getElementById('camHours-exact').value) || 0;
            document.getElementById('total-hours-sum').innerText = formatHMS(h + sh + ch);
            generateReport(total);
        }

        function generateReport(total) {
            const date = document.getElementById('reportDate').value;
            const h = document.getElementById('hours-exact').value || '0h';
            const sh = document.getElementById('streamHours-exact').value || '0h';
            const ch = document.getElementById('camHours-exact').value || '0h';
            const mad = document.getElementById('madrugada-exact').value || '0h';
            const work = document.getElementById('workSchool').checked ? `SIM (${document.getElementById('workSchoolName').value})` : 'NÃO';
            const coletiva = document.getElementById('coletiva').checked ? `SIM (Com: ${document.getElementById('coletivaWith').value})` : 'NÃO';
            
            const shHours = timeToHours(sh);
            const chHours = timeToHours(ch);
            let multText = "1.0x (Normal)";
            if (shHours > 0 && chHours > 0) multText = "1.6x (Foco Máximo)";
            else if (shHours > 0 || chHours > 0) multText = "1.3x (Foco Vídeo)";

            let report = `[RELATÓRIO DE DESEMPENHO - ${date}]\n`;
            report += `-------------------------------------------\n`;
            report += `TEMPO DE ESTUDO: ${h} (Normais)\n`;
            if (shHours > 0 || chHours > 0) report += `CHAMADAS: ${sh} Stream / ${ch} Cam\n`;
            report += `TEMPO TOTAL: ${document.getElementById('total-hours-sum').innerText}\n`;
            report += `FOCO: ${multText}\n`;
            report += `HORAS DE OURO: ${mad}\n`;
            report += `PÁGINAS LIDAS: ${document.getElementById('pages').value}\n`;
            report += `-------------------------------------------\n`;
            report += `REDAÇÕES: ${document.getElementById('essay1').value} N1 | ${document.getElementById('essay2').value} N2 | ${document.getElementById('essay3').value} N3 | ${document.getElementById('essay4').value} N4\n`;
            report += `QUESTÕES MFQ: ${document.getElementById('q_mfq1').value} N1 | ${document.getElementById('q_mfq2').value} N2 | ${document.getElementById('q_mfq3').value} N3 | ${document.getElementById('q_mfq4').value} N4\n`;
            report += `QUESTÕES HUMANAS: ${document.getElementById('q_hum1').value} N1 | ${document.getElementById('q_hum2').value} N2 | ${document.getElementById('q_hum3').value} N3 | ${document.getElementById('q_hum4').value} N4\n`;
            report += `QUESTÕES LINGUAGENS: ${document.getElementById('q_lin1').value} N1 | ${document.getElementById('q_lin2').value} N2 | ${document.getElementById('q_lin3').value} N3 | ${document.getElementById('q_lin4').value} N4\n`;
            report += `-------------------------------------------\n`;
            report += `TEVE AULA/TRABALHO: ${work}\n`;
            report += `LISTA COLETIVA: ${coletiva}\n`;
            report += `SIMULADO: ${document.getElementById('simulado').checked ? 'REALIZADO' : 'NÃO REALIZADO'}\n`;
            report += `-------------------------------------------\n`;
            report += `PONTUAÇÃO FINAL: ${Math.floor(total)} PTS\n`;
            document.getElementById('report').innerText = report;
        }

        function copyReport() {
            const text = document.getElementById('report').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const old = btn.innerText;
                btn.innerText = "COPIADO COM SUCESSO!";
                setTimeout(() => btn.innerText = old, 2000);
            });
        }
        updateDisplay(0);
    </script>
</body>
</html>
